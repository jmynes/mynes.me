<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>mynes.me — Vibed Demos</title>
  <meta name="description" content="A collection of projects built with vibes - showcasing PUNT and Pokeraoke">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="mynes.me — Vibed Demos">
  <meta property="og:description" content="A collection of projects built with vibes">

  <!-- Styles -->
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/aero.css" id="theme-css">

  <script>
    // Prevent scroll restoration on refresh
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    window.scrollTo(0, 0);

    // Theme selection: shuffle ON = random (never same twice), shuffle OFF = keep same theme
    const themes = ['aero', 'bubbly', 'christmas', 'fireflies', 'groovy', 'hacker', 'halloween', 'lilypond', 'powerpc', 'retrogame', 'starwars', 'synthwave', 'underworld'];
    const shuffleEnabled = localStorage.getItem('mynes-shuffle') !== 'false'; // default true
    const lastTheme = localStorage.getItem('mynes-last-theme');
    let selectedTheme;
    if (shuffleEnabled) {
      // Random theme, excluding the last one
      const availableThemes = lastTheme ? themes.filter(t => t !== lastTheme) : themes;
      selectedTheme = availableThemes[Math.floor(Math.random() * availableThemes.length)];
    } else {
      // Keep same theme, or pick random if none saved
      selectedTheme = lastTheme && themes.includes(lastTheme) ? lastTheme : themes[Math.floor(Math.random() * themes.length)];
    }
    localStorage.setItem('mynes-last-theme', selectedTheme);
    const randomTheme = selectedTheme; // keep variable name for compatibility below

    // Set theme immediately to prevent flash
    document.documentElement.dataset.theme = randomTheme;

    // Update CSS link immediately
    document.addEventListener('DOMContentLoaded', () => {
      const themeCss = document.getElementById('theme-css');
      if (themeCss) themeCss.href = `styles/${randomTheme}.css`;

      // Set initial active button
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === randomTheme);
      });

      // Set initial shuffle button state
      const shuffleBtn = document.getElementById('shuffle-btn');
      if (shuffleBtn) {
        shuffleBtn.classList.toggle('active', shuffleEnabled);
      }
    });
  </script>
</head>
<body>
  <!-- Theme Background Layer -->
  <div class="theme-bg" aria-hidden="true">
    <!-- Vista Aurora SVG - shown only for aero theme -->
    <svg class="aurora-svg" viewBox="0 0 1920 1080" preserveAspectRatio="xMidYMid slice">
      <defs>
        <!-- Primary ribbon gradient: gold edge → cyan → green -->
        <linearGradient id="aurora-grad-1" x1="0%" y1="100%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#ffd700" stop-opacity="0.9"/>
          <stop offset="20%" stop-color="#00ffff" stop-opacity="1"/>
          <stop offset="50%" stop-color="#00ffc8" stop-opacity="0.95"/>
          <stop offset="80%" stop-color="#7fff7f" stop-opacity="0.8"/>
          <stop offset="100%" stop-color="#7fff7f" stop-opacity="0"/>
        </linearGradient>

        <!-- Secondary ribbon gradient: yellow → green → cyan -->
        <linearGradient id="aurora-grad-2" x1="0%" y1="100%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#ffff00" stop-opacity="0.8"/>
          <stop offset="25%" stop-color="#c8ff64" stop-opacity="0.95"/>
          <stop offset="50%" stop-color="#7fff7f" stop-opacity="1"/>
          <stop offset="75%" stop-color="#00ffc8" stop-opacity="0.9"/>
          <stop offset="100%" stop-color="#00ffff" stop-opacity="0"/>
        </linearGradient>

        <!-- Tertiary ribbon gradient: cyan dominant -->
        <linearGradient id="aurora-grad-3" x1="0%" y1="100%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#00ffff" stop-opacity="0.7"/>
          <stop offset="40%" stop-color="#00ffc8" stop-opacity="0.9"/>
          <stop offset="70%" stop-color="#7fff7f" stop-opacity="0.8"/>
          <stop offset="100%" stop-color="#c8ff64" stop-opacity="0"/>
        </linearGradient>

        <!-- Horizontal wave gradient -->
        <linearGradient id="wave-grad" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#00ffff" stop-opacity="0"/>
          <stop offset="20%" stop-color="#00ffff" stop-opacity="0.6"/>
          <stop offset="50%" stop-color="#00ffff" stop-opacity="1"/>
          <stop offset="80%" stop-color="#00ffff" stop-opacity="0.6"/>
          <stop offset="100%" stop-color="#00ffff" stop-opacity="0"/>
        </linearGradient>

        <!-- Glow filter for soft edges -->
        <filter id="aurora-glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur in="SourceGraphic" stdDeviation="12" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>

        <!-- Stronger glow for wave -->
        <filter id="wave-glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <!-- Primary ribbon - main flowing S-curve -->
      <path class="aurora-ribbon ribbon-1"
            d="M -200 1100
               C 100 1000, 300 850, 500 750
               S 900 550, 1200 450
               S 1600 300, 1900 200
               C 2100 150, 2200 100, 2300 50"
            fill="none"
            stroke="url(#aurora-grad-1)"
            stroke-width="70"
            stroke-linecap="round"
            filter="url(#aurora-glow)"/>

      <!-- Secondary ribbon - offset curve, thinner -->
      <path class="aurora-ribbon ribbon-2"
            d="M -150 1150
               C 150 1050, 350 920, 580 820
               S 980 640, 1300 540
               S 1700 390, 2000 290
               C 2150 240, 2250 190, 2350 140"
            fill="none"
            stroke="url(#aurora-grad-2)"
            stroke-width="50"
            stroke-linecap="round"
            filter="url(#aurora-glow)"/>

      <!-- Tertiary ribbon - higher, more subtle -->
      <path class="aurora-ribbon ribbon-3"
            d="M -100 1050
               C 200 950, 400 800, 650 700
               S 1050 500, 1400 400
               S 1800 250, 2100 150
               C 2250 100, 2350 60, 2450 20"
            fill="none"
            stroke="url(#aurora-grad-3)"
            stroke-width="40"
            stroke-linecap="round"
            filter="url(#aurora-glow)"
            opacity="0.7"/>

      <!-- Horizontal wave/ridge near bottom -->
      <path class="aurora-wave"
            d="M 0 780
               Q 320 750, 640 780
               T 1280 780
               T 1920 780"
            fill="none"
            stroke="url(#wave-grad)"
            stroke-width="3"
            stroke-linecap="round"
            filter="url(#wave-glow)"/>
    </svg>
  </div>

  <!-- Theme Effects Layer (bubbles, particles, etc) -->
  <div class="theme-effects" aria-hidden="true">
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
  </div>

  <!-- Theme Overlay Layer (lens flare, scanlines, etc) -->
  <div class="theme-overlay" aria-hidden="true"></div>

  <header class="site-header">
    <div class="logo">
      <div class="logo-mark">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
      </div>
      <span class="logo-text">mynes.me</span>
    </div>

    <button class="shuffle-btn active" id="shuffle-btn" aria-label="Toggle shuffle mode">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
      </svg>
      <span class="shuffle-tooltip">Shuffle mode prevents the same theme from loading twice in a row. Leave this on for maximum vibes!</span>
    </button>
    <div class="theme-toggles">
      <button class="theme-btn active" data-theme="aero">Aero</button>
      <button class="theme-btn" data-theme="bubbly">Bubbly</button>
      <button class="theme-btn" data-theme="christmas">Christmas</button>
      <button class="theme-btn" data-theme="fireflies">Fireflies</button>
      <button class="theme-btn" data-theme="groovy">Groovy</button>
      <button class="theme-btn" data-theme="hacker">Hacker</button>
      <button class="theme-btn" data-theme="halloween">Halloween</button>
      <button class="theme-btn" data-theme="lilypond">Lily Pond</button>
      <button class="theme-btn" data-theme="powerpc">PowerPC</button>
      <button class="theme-btn" data-theme="retrogame">Retro Game</button>
      <button class="theme-btn" data-theme="starwars">Star Wars</button>
      <button class="theme-btn" data-theme="synthwave">Synthwave</button>
      <button class="theme-btn" data-theme="underworld">Underworld</button>
    </div>
  </header>

  <main>
    <section class="intro">
      <h1>Projects built<br><em>with vibes</em></h1>
      <p class="intro-sub">Click any screenshot to view full detail</p>
    </section>

    <section class="projects">

      <article class="project">
        <div class="project-screenshot-wrapper" data-project="punt">
          <img
            src="punt-screenshot.webp"
            alt="PUNT - Kanban board interface showing tickets organized in columns"
            class="project-screenshot"
            width="1920"
            height="1080"
            loading="lazy"
          >
          <div class="screenshot-overlay">
            <span class="zoom-hint">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
                <path d="M11 8v6M8 11h6"/>
              </svg>
              Click to expand
            </span>
          </div>
        </div>
        <div class="project-info">
          <div class="project-header">
            <h2 class="project-title">PUNT</h2>
            <div class="project-links">
              <a href="https://github.com/jmynes/punt" class="project-link github" target="_blank" rel="noopener" aria-label="View on GitHub">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
              <a href="#" class="project-link coming-soon">
                Coming Soon
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </a>
            </div>
          </div>
          <p class="project-desc">A self-hosted issue tracker with backlog and Kanban views. Features drag-and-drop boards, sprint planning with carryover tracking, multi-select bulk actions, undo/redo, and real-time sync via SSE. Keep your data on your own infrastructure.</p>
          <div class="project-tech">
            <span class="tech-tag">Next.js</span>
            <span class="tech-tag">SQLite</span>
            <span class="tech-tag">Zustand</span>
            <span class="tech-tag">Prisma</span>
          </div>
        </div>
      </article>

      <article class="project">
        <div class="project-screenshot-wrapper" data-project="pokeraoke">
          <img
            src="pokeraoke-screenshot.png"
            alt="Pokeraoke - Pokemon sprite karaoke interface with lyrics and sprites"
            class="project-screenshot"
            width="1920"
            height="1080"
            loading="lazy"
          >
          <div class="screenshot-overlay">
            <span class="zoom-hint">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
                <path d="M11 8v6M8 11h6"/>
              </svg>
              Click to expand
            </span>
          </div>
        </div>
        <div class="project-info">
          <div class="project-header">
            <h2 class="project-title">Pokeraoke</h2>
            <div class="project-links">
              <a href="https://github.com/jmynes/pokeraoke" class="project-link github" target="_blank" rel="noopener" aria-label="View on GitHub">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
              <a href="https://pokeraoke.pages.dev" class="project-link" target="_blank" rel="noopener">
                Visit Live
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path d="M7 17L17 7M17 7H7M17 7V17"/>
                </svg>
              </a>
            </div>
          </div>
          <p class="project-desc">Turn any lyrics into a Pokemon sprite karaoke performance. Map words to Pokemon, sync with timed LRC files, and watch sprites bounce along to the music. A delightfully absurd way to experience your favorite songs.</p>
          <div class="project-tech">
            <span class="tech-tag">React</span>
            <span class="tech-tag">Tailwind</span>
            <span class="tech-tag">Web Audio</span>
          </div>
        </div>
      </article>

    </section>
  </main>

  <footer class="site-footer">
    <p>Built with vibes by <strong>Jordan Mynes</strong></p>
  </footer>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="lightbox-close" aria-label="Close lightbox">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>
    <div class="lightbox-content">
      <img src="" alt="" class="lightbox-image" id="lightbox-image">
    </div>
    <div class="lightbox-caption" id="lightbox-caption"></div>
    <div class="lightbox-description" id="lightbox-description"></div>
  </div>

  <script>
    // Theme switching
    const themeButtons = document.querySelectorAll('.theme-btn');
    const themeCssLink = document.getElementById('theme-css');

    function setTheme(themeName) {
      // Update CSS link
      themeCssLink.href = `styles/${themeName}.css`;
      document.documentElement.dataset.theme = themeName;

      // Save as last theme for shuffle-off mode
      localStorage.setItem('mynes-last-theme', themeName);

      // Update active button
      themeButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === themeName);
      });
    }

    themeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        if (!btn.disabled) {
          setTheme(btn.dataset.theme);
        }
      });
    });

    // Shuffle toggle
    const shuffleBtn = document.getElementById('shuffle-btn');
    shuffleBtn.addEventListener('click', () => {
      const isActive = shuffleBtn.classList.toggle('active');
      localStorage.setItem('mynes-shuffle', isActive ? 'true' : 'false');
    });

    // Lightbox functionality
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const lightboxCaption = document.getElementById('lightbox-caption');
    const lightboxDescription = document.getElementById('lightbox-description');
    const screenshotWrappers = document.querySelectorAll('.project-screenshot-wrapper');

    const projectInfo = {
      'punt': {
        title: 'PUNT',
        description: 'A self-hosted issue tracker with backlog and Kanban views. Lightweight, local-first project management for teams who want the essentials without the overhead—drag-and-drop boards, sprint planning with carryover tracking, multi-select bulk actions, undo/redo, and real-time sync via SSE. Keep your data on your own infrastructure.'
      },
      'pokeraoke': {
        title: 'Pokeraoke',
        description: 'Built for BradleyRose\'s "21st Night of September" Twitch stream—a semi-nuzlocke run of Pokémon Fire Red Omega++ themed around the Earth, Wind & Fire song. Every caught Pokémon was named after lyrics from the track. This karaoke machine syncs trainer sprites and Pokémon to the music, visualizing Bradley\'s actual catches from the run.'
      }
    };

    screenshotWrappers.forEach(wrapper => {
      wrapper.addEventListener('click', () => {
        const img = wrapper.querySelector('img');
        const project = wrapper.dataset.project;
        const info = projectInfo[project] || { title: '', description: '' };
        lightboxImage.src = img.src;
        lightboxImage.alt = img.alt;
        lightboxCaption.textContent = info.title;
        lightboxDescription.textContent = info.description;
        lightbox.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
      });
    });

    function closeLightbox() {
      lightbox.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox || e.target.closest('.lightbox-close')) {
        closeLightbox();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && lightbox.getAttribute('aria-hidden') === 'false') {
        closeLightbox();
      }
    });

    // ═══════════════════════════════════════════════════════════════════════════
    // Lily Pond Theme — Interactive Effects
    // Falling Wisteria Petals + Fireflies + Water Ripples
    // ═══════════════════════════════════════════════════════════════════════════

    (function initLilyPondEffects() {
      let canvas = null;
      let ctx = null;
      let petals = [];
      let fireflies = [];
      let animationId = null;
      let isActive = false;

      // Wisteria color palette
      const wisteriaColors = [
        { h: 270, s: 50, l: 85 },  // Pale lavender
        { h: 275, s: 45, l: 78 },  // Light purple
        { h: 268, s: 40, l: 70 },  // Medium lavender
        { h: 280, s: 55, l: 65 },  // Deeper purple
        { h: 285, s: 35, l: 90 },  // Almost white purple
      ];

      // Firefly class - warm golden glowing particles
      class Firefly {
        constructor() {
          this.reset();
        }

        reset() {
          this.x = Math.random() * window.innerWidth;
          this.y = Math.random() * window.innerHeight;
          this.size = 2 + Math.random() * 3;
          this.speedX = (Math.random() - 0.5) * 0.4;
          this.speedY = (Math.random() - 0.5) * 0.3;
          this.brightness = Math.random();
          this.brightnessSpeed = 0.008 + Math.random() * 0.015;
          this.brightnessDir = Math.random() > 0.5 ? 1 : -1;
          this.hue = 50 + Math.random() * 25; // Warm gold to amber
          this.maxBrightness = 0.5 + Math.random() * 0.4;
        }

        update() {
          // Gentle floating movement
          this.x += this.speedX + Math.sin(Date.now() * 0.0008 + this.y * 0.01) * 0.25;
          this.y += this.speedY + Math.cos(Date.now() * 0.0008 + this.x * 0.01) * 0.2;

          // Pulsing glow
          this.brightness += this.brightnessSpeed * this.brightnessDir;
          if (this.brightness >= this.maxBrightness || this.brightness <= 0.05) {
            this.brightnessDir *= -1;
          }

          // Wrap around screen
          if (this.x < -20) this.x = window.innerWidth + 20;
          if (this.x > window.innerWidth + 20) this.x = -20;
          if (this.y < -20) this.y = window.innerHeight + 20;
          if (this.y > window.innerHeight + 20) this.y = -20;
        }

        draw(ctx) {
          const alpha = this.brightness;
          const glowSize = this.size * (2 + this.brightness * 2.5);

          // Outer glow
          const gradient = ctx.createRadialGradient(
            this.x, this.y, 0,
            this.x, this.y, glowSize
          );
          gradient.addColorStop(0, `hsla(${this.hue}, 85%, 80%, ${alpha})`);
          gradient.addColorStop(0.3, `hsla(${this.hue}, 75%, 65%, ${alpha * 0.5})`);
          gradient.addColorStop(1, `hsla(${this.hue}, 65%, 45%, 0)`);

          ctx.beginPath();
          ctx.arc(this.x, this.y, glowSize, 0, Math.PI * 2);
          ctx.fillStyle = gradient;
          ctx.fill();

          // Bright core
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size * 0.4, 0, Math.PI * 2);
          ctx.fillStyle = `hsla(${this.hue}, 90%, 92%, ${alpha})`;
          ctx.fill();
        }
      }

      // Wisteria Petal class - falling purple petals
      class Petal {
        constructor() {
          this.reset(true);
        }

        reset(initial = false) {
          this.x = Math.random() * window.innerWidth;
          this.y = initial ? Math.random() * window.innerHeight : -20;
          this.size = 4 + Math.random() * 6;
          this.speedY = 0.4 + Math.random() * 0.8;
          this.speedX = (Math.random() - 0.5) * 0.3;
          this.rotation = Math.random() * 360;
          this.rotationSpeed = (Math.random() - 0.5) * 2;
          this.wobbleOffset = Math.random() * Math.PI * 2;
          this.wobbleSpeed = 0.02 + Math.random() * 0.02;
          this.opacity = 0.5 + Math.random() * 0.4;
          const colorIdx = Math.floor(Math.random() * wisteriaColors.length);
          this.color = wisteriaColors[colorIdx];
        }

        update() {
          // Gentle falling with horizontal wobble
          this.y += this.speedY;
          this.x += this.speedX + Math.sin(Date.now() * this.wobbleSpeed + this.wobbleOffset) * 0.5;
          this.rotation += this.rotationSpeed;

          // Reset when fallen off screen
          if (this.y > window.innerHeight + 20) {
            this.reset();
          }
          // Wrap horizontally
          if (this.x < -20) this.x = window.innerWidth + 20;
          if (this.x > window.innerWidth + 20) this.x = -20;
        }

        draw(ctx) {
          ctx.save();
          ctx.translate(this.x, this.y);
          ctx.rotate((this.rotation * Math.PI) / 180);

          // Petal shape - elongated teardrop
          const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size);
          gradient.addColorStop(0, `hsla(${this.color.h}, ${this.color.s}%, ${this.color.l + 10}%, ${this.opacity})`);
          gradient.addColorStop(0.6, `hsla(${this.color.h}, ${this.color.s}%, ${this.color.l}%, ${this.opacity * 0.8})`);
          gradient.addColorStop(1, `hsla(${this.color.h}, ${this.color.s + 10}%, ${this.color.l - 10}%, 0)`);

          ctx.beginPath();
          ctx.ellipse(0, 0, this.size * 0.4, this.size, 0, 0, Math.PI * 2);
          ctx.fillStyle = gradient;
          ctx.fill();

          // Subtle highlight
          ctx.beginPath();
          ctx.ellipse(-this.size * 0.1, -this.size * 0.3, this.size * 0.15, this.size * 0.3, -0.3, 0, Math.PI * 2);
          ctx.fillStyle = `hsla(${this.color.h}, ${this.color.s - 10}%, 95%, ${this.opacity * 0.4})`;
          ctx.fill();

          ctx.restore();
        }
      }

      function createCanvas() {
        canvas = document.createElement('canvas');
        canvas.id = 'firefly-canvas';
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        document.body.appendChild(canvas);
        ctx = canvas.getContext('2d');
      }

      function removeCanvas() {
        if (canvas && canvas.parentNode) {
          canvas.parentNode.removeChild(canvas);
        }
        canvas = null;
        ctx = null;
      }

      function initParticles() {
        // Petals - more numerous
        const petalCount = Math.min(35, Math.floor(window.innerWidth * window.innerHeight / 30000));
        petals = [];
        for (let i = 0; i < petalCount; i++) {
          petals.push(new Petal());
        }

        // Fireflies - fewer, magical accents
        const fireflyCount = Math.min(18, Math.floor(window.innerWidth * window.innerHeight / 60000));
        fireflies = [];
        for (let i = 0; i < fireflyCount; i++) {
          fireflies.push(new Firefly());
        }
      }

      function animate() {
        if (!isActive || !ctx) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw petals first (behind fireflies)
        petals.forEach(petal => {
          petal.update();
          petal.draw(ctx);
        });

        // Draw fireflies on top (they glow)
        fireflies.forEach(firefly => {
          firefly.update();
          firefly.draw(ctx);
        });

        animationId = requestAnimationFrame(animate);
      }

      function handleResize() {
        if (canvas) {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
      }

      // Water ripple effect on click/touch
      function createRipple(x, y) {
        const ripple = document.createElement('div');
        ripple.className = 'pond-ripple';
        const size = 150 + Math.random() * 100;
        ripple.style.width = size + 'px';
        ripple.style.height = size + 'px';
        ripple.style.left = (x - size / 2) + 'px';
        ripple.style.top = (y - size / 2) + 'px';
        document.body.appendChild(ripple);

        // Create secondary smaller ripple
        setTimeout(() => {
          const ripple2 = document.createElement('div');
          ripple2.className = 'pond-ripple';
          const size2 = size * 0.6;
          ripple2.style.width = size2 + 'px';
          ripple2.style.height = size2 + 'px';
          ripple2.style.left = (x - size2 / 2) + 'px';
          ripple2.style.top = (y - size2 / 2) + 'px';
          ripple2.style.animationDuration = '1s';
          document.body.appendChild(ripple2);
          setTimeout(() => ripple2.remove(), 1000);
        }, 150);

        // Remove after animation
        setTimeout(() => ripple.remove(), 1200);
      }

      function handleClick(e) {
        if (!isActive) return;
        // Don't create ripples on interactive elements
        if (e.target.closest('a, button, .project-screenshot-wrapper, .lightbox')) return;
        createRipple(e.clientX, e.clientY);
      }

      function start() {
        if (isActive) return;
        isActive = true;
        createCanvas();
        initParticles();
        animate();
        window.addEventListener('resize', handleResize);
        document.addEventListener('click', handleClick);
      }

      function stop() {
        if (!isActive) return;
        isActive = false;
        if (animationId) {
          cancelAnimationFrame(animationId);
          animationId = null;
        }
        removeCanvas();
        petals = [];
        fireflies = [];
        window.removeEventListener('resize', handleResize);
        document.removeEventListener('click', handleClick);
        // Clean up any remaining ripples
        document.querySelectorAll('.pond-ripple').forEach(r => r.remove());
      }

      function checkTheme() {
        const currentTheme = document.documentElement.dataset.theme;
        if (currentTheme === 'lilypond') {
          start();
        } else {
          stop();
        }
      }

      // Watch for theme changes
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === 'data-theme') {
            checkTheme();
          }
        });
      });

      observer.observe(document.documentElement, { attributes: true });

      // Initial check
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkTheme);
      } else {
        checkTheme();
      }
    })();

    // ═══════════════════════════════════════════════════════════════════════════
    // Underworld Theme — Dynamic Ember Effects
    // Rising embers, smouldering particles, hellish glow
    // ═══════════════════════════════════════════════════════════════════════════

    (function initUnderworldEffects() {
      let canvas = null;
      let ctx = null;
      let embers = [];
      let animationId = null;
      let isActive = false;

      // Ember particle class
      class Ember {
        constructor() {
          this.reset();
        }

        reset() {
          this.x = Math.random() * window.innerWidth;
          this.y = window.innerHeight + 20;
          this.size = 2 + Math.random() * 4;
          this.speedY = -(1.5 + Math.random() * 2.5); // Rising speed
          this.speedX = (Math.random() - 0.5) * 1.5; // Horizontal drift
          this.life = 1;
          this.decay = 0.003 + Math.random() * 0.005;
          this.brightness = 0.8 + Math.random() * 0.2;
          this.flickerSpeed = 0.05 + Math.random() * 0.1;
          this.flickerOffset = Math.random() * Math.PI * 2;
          // Color varies from yellow-orange to deep red
          this.hue = 15 + Math.random() * 30; // 15-45 (orange-yellow range)
        }

        update() {
          // Rise upward with slight wave motion
          this.y += this.speedY;
          this.x += this.speedX + Math.sin(Date.now() * 0.002 + this.flickerOffset) * 0.5;

          // Decrease life
          this.life -= this.decay;

          // Flicker brightness
          const flicker = Math.sin(Date.now() * this.flickerSpeed + this.flickerOffset) * 0.2;
          this.currentBrightness = Math.max(0.3, this.brightness + flicker);

          // Respawn when dead or off screen
          if (this.life <= 0 || this.y < -20) {
            this.reset();
          }
        }

        draw(ctx) {
          const alpha = this.life * this.currentBrightness;
          const glowSize = this.size * (2 + this.life);

          // Outer glow
          const gradient = ctx.createRadialGradient(
            this.x, this.y, 0,
            this.x, this.y, glowSize
          );
          gradient.addColorStop(0, `hsla(${this.hue}, 100%, 70%, ${alpha})`);
          gradient.addColorStop(0.3, `hsla(${this.hue - 10}, 90%, 50%, ${alpha * 0.6})`);
          gradient.addColorStop(0.6, `hsla(${this.hue - 20}, 80%, 30%, ${alpha * 0.3})`);
          gradient.addColorStop(1, `hsla(0, 100%, 20%, 0)`);

          ctx.beginPath();
          ctx.arc(this.x, this.y, glowSize, 0, Math.PI * 2);
          ctx.fillStyle = gradient;
          ctx.fill();

          // Bright hot core
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size * 0.4, 0, Math.PI * 2);
          ctx.fillStyle = `hsla(${this.hue + 10}, 100%, 90%, ${alpha})`;
          ctx.fill();
        }
      }

      function createCanvas() {
        canvas = document.createElement('canvas');
        canvas.id = 'underworld-canvas';
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        document.body.appendChild(canvas);
        ctx = canvas.getContext('2d');
      }

      function removeCanvas() {
        if (canvas && canvas.parentNode) {
          canvas.parentNode.removeChild(canvas);
        }
        canvas = null;
        ctx = null;
      }

      function initEmbers() {
        // More embers for intense smouldering effect
        const count = Math.min(40, Math.floor(window.innerWidth * window.innerHeight / 25000));
        embers = [];
        for (let i = 0; i < count; i++) {
          const ember = new Ember();
          // Stagger initial positions
          ember.y = Math.random() * window.innerHeight;
          ember.life = Math.random();
          embers.push(ember);
        }
      }

      function animate() {
        if (!isActive || !ctx) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        embers.forEach(ember => {
          ember.update();
          ember.draw(ctx);
        });

        animationId = requestAnimationFrame(animate);
      }

      function handleResize() {
        if (canvas) {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
      }

      function start() {
        if (isActive) return;
        isActive = true;
        createCanvas();
        initEmbers();
        animate();
        window.addEventListener('resize', handleResize);
      }

      function stop() {
        if (!isActive) return;
        isActive = false;
        if (animationId) {
          cancelAnimationFrame(animationId);
          animationId = null;
        }
        removeCanvas();
        embers = [];
        window.removeEventListener('resize', handleResize);
      }

      function checkTheme() {
        const currentTheme = document.documentElement.dataset.theme;
        if (currentTheme === 'underworld') {
          start();
        } else {
          stop();
        }
      }

      // Watch for theme changes
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === 'data-theme') {
            checkTheme();
          }
        });
      });

      observer.observe(document.documentElement, { attributes: true });

      // Initial check
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkTheme);
      } else {
        checkTheme();
      }
    })();
  </script>
</body>
</html>
